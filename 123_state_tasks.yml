# Do not edit - automatically generated
# from the task_makefile.mustache template
# by create_task_makefile() via do_state_tasks()
# using scipiper package version 0.0.18

target_default: 123_state_tasks

include:
  - remake.yml

packages:
  - dataRetrieval
  - tidyverse
  - lubridate

sources:
  - 1_fetch/src/get_site_data.R
  - 3_visualize/src/plot_site_data.R
  - 2_process/src/tally_site_obs.R
  - 123_state_tasks.R

file_extensions:
  - "ind"

targets:
  123_state_tasks:
    depends:
      - obs_tallies_promise
      - timeseries_plots.yml_promise

  # --- WI --- #
  
  WI_data:
    command: get_site_data(
      sites_info_file = '1_fetch/tmp/inventory_WI.tsv',
      parameter = parameter)

  3_visualize/out/timeseries_WI.png:
    command: plot_site_data(out_file = target_name,
      site_data = WI_data,
      parameter = parameter)

  WI_tally:
    command: tally_site_obs(WI_data)

  # --- MN --- #
  
  MN_data:
    command: get_site_data(
      sites_info_file = '1_fetch/tmp/inventory_MN.tsv',
      parameter = parameter)

  3_visualize/out/timeseries_MN.png:
    command: plot_site_data(out_file = target_name,
      site_data = MN_data,
      parameter = parameter)

  MN_tally:
    command: tally_site_obs(MN_data)

  # --- MI --- #
  
  MI_data:
    command: get_site_data(
      sites_info_file = '1_fetch/tmp/inventory_MI.tsv',
      parameter = parameter)

  3_visualize/out/timeseries_MI.png:
    command: plot_site_data(out_file = target_name,
      site_data = MI_data,
      parameter = parameter)

  MI_tally:
    command: tally_site_obs(MI_data)

  # --- IL --- #
  
  IL_data:
    command: get_site_data(
      sites_info_file = '1_fetch/tmp/inventory_IL.tsv',
      parameter = parameter)

  3_visualize/out/timeseries_IL.png:
    command: plot_site_data(out_file = target_name,
      site_data = IL_data,
      parameter = parameter)

  IL_tally:
    command: tally_site_obs(IL_data)

  # --- Overall job --- #

  obs_tallies_promise:
    command: combine_obs_tallies(
      `WI_tally`,
      '3_visualize/out/timeseries_WI.png',
      `MN_tally`,
      '3_visualize/out/timeseries_MN.png',
      `MI_tally`,
      '3_visualize/out/timeseries_MI.png',
      `IL_tally`,
      '3_visualize/out/timeseries_IL.png')
    
  timeseries_plots.yml_promise:
    command: summarize_timeseries_plots(I('3_visualize/out/timeseries_plots.yml'),
      `WI_tally`,
      '3_visualize/out/timeseries_WI.png',
      `MN_tally`,
      '3_visualize/out/timeseries_MN.png',
      `MI_tally`,
      '3_visualize/out/timeseries_MI.png',
      `IL_tally`,
      '3_visualize/out/timeseries_IL.png')
    
